#%SED_GAWK_PATH%

# ------------------------------------------------------------
# cawk is subjet to a MIT open-source licence
# please refer to the MIT licence file for further information
#
# for %SED_VAR% change like GAWK_PATH, etc. please refer to
# file support/tests.sed for further information
#
# purpose : check if <bind acl defined> is set
# author  : julien lair
# ------------------------------------------------------------

@include %SED_INCLUDE_PATH%

BEGIN {
}

BEGINFILE {
    delete list_ACL_use;
    delete list_ACL_defined;
    pass = 1;
}

/^bind .* acl[ ]*$/ {
    print_err("access_bindacldefined_set.ekinops-oneos.gawk","<bind acl defined> is defined without acl : "$0,FNR,"high","error");
    pass = 0;
    next;
}

/^bind .* acl [^ ].*$/{
    list_ACL_use[$4] = 1;
    next; 
}

/^ip access-list (extended|standard) [^ ]+.*$/{
    list_ACL_defined[$4] = 1;
    next;
}

ENDFILE {
    # check acls found ----
    for (acl in list_ACL_use) {
        if(!(acl in list_ACL_defined)){
            print_err("access_bindacldefined_set.ekinops-oneos.gawk","<bind acl defined> is not defined : "acl,0,"high","error");
            pass = 0;
        }
    }

    if ( pass ) print_err("access_bindacldefined_set.ekinops-oneos.gawk","<bind acl defined> is set",0,"high","pass");
}

END {
}
